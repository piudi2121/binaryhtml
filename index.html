<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Binário Matrix Trainer</title>

		<style>
			/* CSS Geral */
			body {
				background-color: #181c14;
				color: #ecdfcc;
				font-family: "Courier New", monospace;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				width: 100vw;
				margin: 0;
				overflow: hidden;
				user-select: none;
				font-weight: 100; /* Peso da fonte mais fino */
			}

			/* Estilo da tela de input */
			#input-screen {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100%;
				width: 100%;
				text-align: center;
				padding: 20px;
				box-sizing: border-box;
			}

			#file-input {
				padding: 15px;
				font-size: 1.5rem;
				text-align: center;
				border: 2px solid #ecdfcc;
				background-color: #333;
				color: #ecdfcc;
				width: 80%;
				max-width: 300px;
				margin-top: 20px;
				font-weight: 300;
			}

			/* Estilo da tela principal (jogo) */
			#game-screen {
				display: none;
				height: 100%;
				width: 100%;
				/* Flexbox para centralizar os dois elementos */
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			
			/* Contêiner para a Matriz Binária e o Texto da Imagem */
			#display-container {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				width: 100%;
			}


			/* ESTILO ESPECÍFICO DO BINÁRIO (MAIOR) */
			#matrix-display {
				/* 4vw para desktop */
				font-size: 4vw; 
				
				white-space: pre;
				line-height: 1.2;
				
				margin: 0;
				padding: 0;
				text-align: center;
				font-weight: 100;
				
				/* Garante que o binário fique centralizado no espaço dele */
				display: block; 
			}

			/* ESTILO ESPECÍFICO DO TEXTO DA IMAGEM (MENOR) */
			#image-text {
				/* 7vw para desktop (já menor que o binário) */
				font-size: 2.5vw; 
				color: #ecdfcc;
				margin-top: 30px; /* Espaço entre a matriz e o texto */
				text-align: center;
				font-weight: 100;
				
				/* Começa oculto */
				display: none; 
			}


			/* Mídia Query para telas menores (Celulares) - AUMENTA O BINÁRIO e AJUSTA O TEXTO */
			@media (max-width: 600px) {
				#matrix-display {
					/* 12vw para números binários em celular */
					font-size: 12vw; 
				}
				#image-text {
					/* 7vw para o texto da imagem em celular */
					font-size: 7vw;
				}
			}

			/* Contador e Mensagens (sem alterações significativas) */
			#counter-display {
				position: absolute;
				top: 20px;
				right: 20px;
				font-size: 1.2rem;
				color: #697565;
				font-weight: 300;
			}

			#status-message {
				position: fixed;
				bottom: 10%;
				font-size: 1rem;
				color: red;
				display: none;
				font-weight: 300;
			}
		</style>
	</head>
	<body>
		<div id="input-screen">
			<h1>Memorização de Matriz Binária</h1>
			<label for="file-input" style="font-size: 24px"
				>Digite o número da planilha:</label
			>
			<input
				type="text"
				id="file-input"
				placeholder="Nome do arquivo (ex: 1307)"
			/>
			<p style="margin-top: 20px; color: #697565">
				Pressione ENTER para carregar.
			</p>
			<p id="status-message-input" style="color: red; margin-top: 15px"></p>
		</div>

		<div id="game-screen">
			<div id="counter-display">
				Contador: <span id="counter-value">0</span>
			</div>

			<div id="display-container">
				<pre id="matrix-display">Carregando...</pre>
				<div id="image-text"></div> </div>
			
			<div id="status-message"></div>
		</div>

		<script>
			// Variáveis de Estado
			let tabela = {};
			let binarios = [];
			let estadoMostrandoImagem = false;
			let binarioAtual = "";
			let contador = 0;
			let nomeBase = "";

			// Referências DOM
			const inputScreen = document.getElementById("input-screen");
			const gameScreen = document.getElementById("game-screen");
			const fileInput = document.getElementById("file-input");
			const matrixDisplay = document.getElementById("matrix-display");
			const imageText = document.getElementById("image-text"); // NOVO ELEMENTO
			const counterValue = document.getElementById("counter-value");
			const statusMessageInput = document.getElementById(
				"status-message-input"
			);

			// --- Funções Auxiliares ---

			/**
			 * Converte uma string binária de 9 dígitos para o formato 3x3 com quebras de linha.
			 */
			function binarioParaMatriz(binario) {
				if (typeof binario !== "string" || binario.length !== 9) {
					return "ERRO";
				}
				return `${binario.slice(0, 3)}\n${binario.slice(3, 6)}\n${binario.slice(
					6,
					9
				)}`;
			}

			/**
			 * Lógica principal para avançar no jogo (Mostrar Binário ou Mostrar Imagem).
			 */
			function proximaAcao() {
				if (Object.keys(tabela).length === 0) {
					return;
				}

				if (!estadoMostrandoImagem) {
					// 1. Mostrar o Binário (Matriz)
					binarioAtual = binarios[Math.floor(Math.random() * binarios.length)];
					
					matrixDisplay.textContent = binarioParaMatriz(binarioAtual);
					imageText.textContent = ""; // Limpa o texto da imagem
					imageText.style.display = "none"; // Oculta o texto da imagem
					
					contador++;
					counterValue.textContent = contador;
					estadoMostrandoImagem = true;
				} else {
					// 2. Mostrar a Imagem (Resultado)
					const imagem = tabela[binarioAtual] || "Imagem não encontrada.";
					
					// Mostra a Matriz (opcionalmente, pode-se limpar para focar só na imagem)
					// Mas vamos manter para referência visual, como estava no código original
					// matrixDisplay.textContent = binarioParaMatriz(binarioAtual); 
					
					imageText.textContent = imagem; // Coloca a imagem no elemento separado
					imageText.style.display = "block"; // Mostra o texto da imagem
					
					estadoMostrandoImagem = false;
				}
			}

			/**
			 * Carrega o arquivo JSON correspondente ao nome base.
			 */
			async function carregarDados(nome) {
				nomeBase = nome.trim();
				const nomeArquivo = `${nomeBase}.json`;
				statusMessageInput.textContent = `Tentando carregar ${nomeArquivo}...`;

				try {
					const response = await fetch(nomeArquivo);
					if (!response.ok) {
						throw new Error(
							`Erro de rede ou arquivo não encontrado: ${response.status}`
						);
					}

					const dados = await response.json();

					tabela = {};
					dados.forEach((item) => {
						tabela[item.binario] = item.imagem;
					});

					binarios = Object.keys(tabela);

					if (binarios.length === 0) {
						throw new Error(
							"O arquivo JSON está vazio ou no formato incorreto."
						);
					}

					// Inicia o jogo
					inputScreen.style.display = "none";
					gameScreen.style.display = "flex";
					proximaAcao(); // Mostra a primeira matriz
					statusMessageInput.textContent = "";
				} catch (error) {
					console.error("Falha ao carregar os dados:", error);
					statusMessageInput.textContent = `ERRO: Não foi possível carregar os dados de '${nomeArquivo}'. Verifique se o arquivo existe e se o nome está correto.`;
				}
			}

			// --- Event Listeners (Mantidos) ---
			fileInput.addEventListener("keypress", function (e) {
				if (e.key === "Enter") {
					const nome = fileInput.value;
					if (nome) {
						carregarDados(nome);
					} else {
						statusMessageInput.textContent =
							"Por favor, digite o nome da planilha.";
					}
				}
			});

			document.addEventListener("keydown", function (e) {
				if (gameScreen.style.display !== "none") {
					if (e.key === "Escape") {
						gameScreen.style.display = "none";
						inputScreen.style.display = "flex";
						// Reset do estado
						estadoMostrandoImagem = false;
						contador = 0;
						counterValue.textContent = 0;
						fileInput.value = "";
						matrixDisplay.textContent = "Carregando...";
						imageText.textContent = "";
						imageText.style.display = "none";
					} else if (e.key === "Enter" || e.key.length === 1 || e.key === " ") {
						proximaAcao();
					}
				}
			});

			document.addEventListener("click", function () {
				if (gameScreen.style.display !== "none") {
					proximaAcao();
				}
			});

			// Foco inicial
			fileInput.focus();
		</script>
	</body>
</html>
